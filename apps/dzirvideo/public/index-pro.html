<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DzirVideo PRO - Studio de YouTube Shorts IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-2">üé¨ DzirVideo PRO</h1>
            <p class="text-white/80 text-xl">Studio professionnel de YouTube Shorts avec Assistant IA</p>
        </div>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

            <!-- LEFT: AI Assistant Chat -->
            <div class="glass rounded-2xl shadow-2xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">ü§ñ Assistant IA</h2>
                    <span class="flex items-center gap-2 text-sm text-green-600">
                        <span class="pulse-dot w-2 h-2 bg-green-600 rounded-full"></span>
                        En ligne
                    </span>
                </div>

                <!-- Chat Messages -->
                <div id="chat-container" class="h-96 overflow-y-auto mb-4 space-y-3 p-4 bg-gray-50 rounded-lg">
                    <div class="chat-message bg-purple-100 p-3 rounded-lg">
                        <p class="text-sm font-semibold text-purple-800 mb-1">Assistant IA</p>
                        <p class="text-gray-700">üëã Salut ! Je suis ton assistant pour cr√©er des scripts YouTube Shorts viraux.</p>
                        <p class="text-gray-700 mt-2">Dis-moi sur quoi tu veux faire une vid√©o, et je vais cr√©er un script optimis√© avec :</p>
                        <ul class="list-disc ml-6 mt-2 text-gray-700 text-sm">
                            <li>Hook accrocheur (3 premi√®res secondes)</li>
                            <li>Structure engageante</li>
                            <li>Call-to-action efficace</li>
                            <li>Titre + description + tags SEO</li>
                        </ul>
                        <p class="text-gray-700 mt-2 font-semibold">üí° Exemple : "L'IA va remplacer les d√©veloppeurs"</p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="flex gap-2">
                    <input
                        type="text"
                        id="chat-input"
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Ton id√©e de vid√©o..."
                        onkeypress="if(event.key==='Enter') sendMessage()"
                    >
                    <button
                        onclick="sendMessage()"
                        class="bg-purple-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-purple-700 transition-all"
                    >
                        Envoyer
                    </button>
                </div>

                <!-- Quick Actions -->
                <div class="mt-4 flex flex-wrap gap-2">
                    <button onclick="quickIdea('tech')" class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-full hover:bg-blue-200">
                        üíª Tech
                    </button>
                    <button onclick="quickIdea('business')" class="text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full hover:bg-green-200">
                        üí∞ Business
                    </button>
                    <button onclick="quickIdea('education')" class="text-xs bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full hover:bg-yellow-200">
                        üìö √âducation
                    </button>
                    <button onclick="quickIdea('motivation')" class="text-xs bg-red-100 text-red-700 px-3 py-1 rounded-full hover:bg-red-200">
                        üî• Motivation
                    </button>
                </div>
            </div>

            <!-- RIGHT: Video Creation Form -->
            <div class="glass rounded-2xl shadow-2xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üé• Cr√©ation de Vid√©o</h2>

                <!-- Form Container -->
                <div id="form-container">
                    <!-- Script Preview -->
                    <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-sm font-semibold text-blue-800">üìù Script actuel</p>
                            <span id="script-length" class="text-xs text-blue-600">0 caract√®res</span>
                        </div>
                        <textarea
                            id="script"
                            rows="8"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                            placeholder="Le script appara√Ætra ici apr√®s que l'assistant l'ait cr√©√©... Ou tape ton propre script."
                            oninput="updateScriptLength()"
                        ></textarea>
                    </div>

                    <!-- Title & Description -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Titre
                        </label>
                        <input
                            type="text"
                            id="title"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="Auto-g√©n√©r√© par l'IA ou entre le tien"
                        >
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Description (optionnel)
                        </label>
                        <input
                            type="text"
                            id="description"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="Auto-g√©n√©r√©e par l'IA"
                        >
                    </div>

                    <!-- Advanced Options (Collapsible) -->
                    <div class="mb-4">
                        <button
                            onclick="toggleAdvanced()"
                            class="text-sm text-purple-600 font-semibold hover:text-purple-800"
                        >
                            ‚öôÔ∏è Options avanc√©es
                        </button>
                        <div id="advanced-options" class="hidden mt-3 p-4 bg-gray-50 rounded-lg space-y-3">
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 mb-1">Voix</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                    <option>Josh (Masculin - √ânergique)</option>
                                    <option>Rachel (F√©minin - Professionnel)</option>
                                    <option>Antoine (Masculin - Calme)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 mb-1">Style sous-titres</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                    <option>MrBeast (Gras, jaune)</option>
                                    <option>Ali Abdaal (Minimaliste)</option>
                                    <option>Classic (Blanc sur noir)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-700 mb-1">Musique de fond</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                    <option>Upbeat Tech</option>
                                    <option>Calm Piano</option>
                                    <option>Energetic EDM</option>
                                    <option>Aucune</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Create Button -->
                    <button
                        onclick="createVideo()"
                        class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg"
                    >
                        üé¨ Cr√©er la Vid√©o PRO
                    </button>
                </div>

                <!-- Progress -->
                <div id="progress-container" class="hidden">
                    <div class="text-center mb-4">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
                        <p class="mt-4 text-gray-700 font-medium" id="progress-text">G√©n√©ration de la vid√©o en cours...</p>
                        <p class="text-sm text-gray-500 mt-2" id="progress-step">√âtape 1/5: Synth√®se vocale...</p>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="progress-bar" class="bg-purple-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Result -->
                <div id="result-container" class="hidden">
                    <div class="text-center mb-6">
                        <div class="inline-block p-4 bg-green-100 rounded-full mb-4">
                            <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Vid√©o cr√©√©e avec succ√®s!</h3>
                        <p class="text-gray-600" id="video-info"></p>
                    </div>

                    <div class="mb-6">
                        <video id="video-player" controls class="w-full rounded-lg shadow-lg">
                            <source id="video-source" type="video/mp4">
                            Votre navigateur ne supporte pas la lecture vid√©o.
                        </video>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <button
                            onclick="downloadVideo()"
                            class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all"
                        >
                            üì• T√©l√©charger
                        </button>
                        <button
                            onclick="resetForm()"
                            class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 transition-all"
                        >
                            ‚ûï Nouvelle Vid√©o
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Stats -->
        <div class="glass rounded-xl p-4 text-center">
            <div class="grid grid-cols-3 gap-4 text-gray-700">
                <div>
                    <p class="text-2xl font-bold text-purple-600">98%</p>
                    <p class="text-sm">Taux de satisfaction</p>
                </div>
                <div>
                    <p class="text-2xl font-bold text-purple-600">1,247</p>
                    <p class="text-sm">Vid√©os cr√©√©es</p>
                </div>
                <div>
                    <p class="text-2xl font-bold text-purple-600">4.2M</p>
                    <p class="text-sm">Vues g√©n√©r√©es</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentVideoPath = '';
        let optimizedScript = null;

        function updateScriptLength() {
            const script = document.getElementById('script').value;
            document.getElementById('script-length').textContent = script.length + ' caract√®res';
        }

        function toggleAdvanced() {
            const advanced = document.getElementById('advanced-options');
            advanced.classList.toggle('hidden');
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            addTypingIndicator();

            try {
                // Call AI optimization endpoint
                const response = await fetch('/ai/optimize-script', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        raw_idea: message,
                        niche: 'general',
                        tone: 'energetic'
                    })
                });

                removeTypingIndicator();

                if (!response.ok) throw new Error('AI service error');

                const data = await response.json();
                optimizedScript = data;

                // Add AI response
                const aiMessage = formatAIResponse(data);
                addChatMessage(aiMessage, 'assistant');

                // Fill form with optimized data
                fillForm(data);

            } catch (error) {
                removeTypingIndicator();
                addChatMessage('‚ùå Erreur lors de l\'optimisation. Utilisation du mode basique...', 'assistant');

                // Fallback: use basic script
                document.getElementById('script').value = message;
                document.getElementById('title').value = message.substring(0, 60);
                updateScriptLength();
            }
        }

        function formatAIResponse(data) {
            return `
‚úÖ <strong>Script optimis√© cr√©√© !</strong><br><br>

üìä <strong>Score viral :</strong> ${data.viral_score}/100<br><br>

<strong>üéØ HOOK :</strong><br>
${data.hook}<br><br>

<strong>üí° Am√©liorations sugg√©r√©es :</strong><br>
${data.improvements.map(imp => `‚Ä¢ ${imp}`).join('<br>')}<br><br>

Le script complet est maintenant dans le formulaire √† droite. Tu peux le modifier ou cr√©er la vid√©o directement !
            `;
        }

        function fillForm(data) {
            document.getElementById('script').value = data.full_script;
            document.getElementById('title').value = data.title;
            document.getElementById('description').value = data.description;
            updateScriptLength();
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = 'chat-message ' + (sender === 'user' ? 'bg-white' : 'bg-purple-100') + ' p-3 rounded-lg';

            const senderLabel = sender === 'user' ? 'Toi' : 'Assistant IA';
            const senderColor = sender === 'user' ? 'text-gray-800' : 'text-purple-800';

            div.innerHTML = `
                <p class="text-sm font-semibold ${senderColor} mb-1">${senderLabel}</p>
                <p class="text-gray-700 text-sm">${message}</p>
            `;

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function addTypingIndicator() {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.id = 'typing-indicator';
            div.className = 'chat-message bg-purple-100 p-3 rounded-lg';
            div.innerHTML = `
                <p class="text-sm font-semibold text-purple-800 mb-1">Assistant IA</p>
                <p class="text-gray-700">
                    <span class="inline-block w-2 h-2 bg-purple-600 rounded-full animate-bounce mr-1"></span>
                    <span class="inline-block w-2 h-2 bg-purple-600 rounded-full animate-bounce mr-1" style="animation-delay: 0.1s"></span>
                    <span class="inline-block w-2 h-2 bg-purple-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                </p>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        function quickIdea(niche) {
            const ideas = {
                tech: "L'IA va remplacer 80% des d√©veloppeurs d'ici 2026",
                business: "Comment j'ai gagn√© 10K‚Ç¨ en 30 jours avec cette m√©thode",
                education: "Les 3 secrets que les profs ne te disent jamais",
                motivation: "Si tu ne fais pas √ßa maintenant, tu le regretteras dans 5 ans"
            };
            document.getElementById('chat-input').value = ideas[niche];
            sendMessage();
        }

        async function createVideo() {
            const script = document.getElementById('script').value;
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;

            if (!script.trim()) {
                alert('Utilise l\'assistant IA ou entre un script manuellement');
                return;
            }

            if (!title.trim()) {
                alert('Entre un titre pour la vid√©o');
                return;
            }

            // Hide form, show progress
            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('progress-container').classList.remove('hidden');

            // Simulate detailed progress
            const steps = [
                { text: 'Synth√®se vocale...', percent: 20 },
                { text: 'G√©n√©ration des sous-titres...', percent: 40 },
                { text: 'Cr√©ation de la vid√©o...', percent: 60 },
                { text: 'Ajout de la musique...', percent: 80 },
                { text: 'Finalisation...', percent: 90 }
            ];

            let currentStep = 0;
            const stepInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    document.getElementById('progress-step').textContent =
                        `√âtape ${currentStep + 1}/${steps.length}: ${steps[currentStep].text}`;
                    document.getElementById('progress-bar').style.width = steps[currentStep].percent + '%';
                    currentStep++;
                }
            }, 1000);

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json; charset=utf-8' },
                    body: JSON.stringify({
                        script_text: script,
                        title: title,
                        description: description || undefined,
                        publish: false
                    })
                });

                clearInterval(stepInterval);
                document.getElementById('progress-bar').style.width = '100%';

                if (!response.ok) throw new Error('Erreur g√©n√©ration');

                const data = await response.json();

                if (data.success) {
                    currentVideoPath = data.video_path;
                    document.getElementById('progress-container').classList.add('hidden');
                    document.getElementById('result-container').classList.remove('hidden');
                    document.getElementById('video-info').textContent =
                        `Dur√©e: ${data.duration.toFixed(1)}s | Titre: ${data.title}`;
                    document.getElementById('video-source').src = '/' + data.video_path;
                    document.getElementById('video-player').load();
                } else {
                    throw new Error(data.error || 'Erreur inconnue');
                }
            } catch (error) {
                clearInterval(stepInterval);
                alert('Erreur: ' + error.message);
                resetForm();
            }
        }

        function downloadVideo() {
            if (currentVideoPath) {
                const a = document.createElement('a');
                a.href = '/' + currentVideoPath;
                a.download = currentVideoPath.split('/').pop();
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }

        function resetForm() {
            document.getElementById('form-container').classList.remove('hidden');
            document.getElementById('progress-container').classList.add('hidden');
            document.getElementById('result-container').classList.add('hidden');
            currentVideoPath = '';
        }
    </script>
</body>
</html>
