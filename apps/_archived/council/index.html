<!DOCTYPE html>
<html lang="fr" data-theme="dark" data-iaf-auto-init>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Your Council - IA Factory Algeria</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Dark Mode (default) - Align√© avec Landing Page */
            --bg-primary: #020617;
            --bg-secondary: #020617;
            --bg-card: #020617;
            --bg-card-hover: #0a0f1a;
            --border-color: rgba(255, 255, 255, 0.12);
            --text-primary: #f8fafc;
            --text-secondary: rgba(248, 250, 252, 0.75);
            --text-muted: rgba(248, 250, 252, 0.5);
            --accent-primary: #00a651;
            --accent-secondary: #00c95d;
            --accent-gradient: linear-gradient(135deg, #00a651, #008c45);
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.1);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.1);
            --error: #ef4444;
            --input-bg: #0f172a;
            --input-border: rgba(255, 255, 255, 0.15);
            --input-text: #f8fafc;
            --input-placeholder: rgba(248, 250, 252, 0.5);
        }

        [data-theme="light"] {
            --bg-primary: #f7f5f0;
            --bg-secondary: #f7f5f0;
            --bg-card: #f7f5f0;
            --bg-card-hover: #efe9df;
            --border-color: rgba(0, 0, 0, 0.08);
            --text-primary: #0f172a;
            --text-secondary: rgba(15, 23, 42, 0.7);
            --text-muted: rgba(15, 23, 42, 0.5);
            --accent-primary: #00a651;
            --accent-secondary: #008c45;
            --accent-gradient: linear-gradient(135deg, #00a651, #008c45);
            --success-bg: rgba(16, 185, 129, 0.1);
            --warning-bg: rgba(245, 158, 11, 0.1);
            --input-bg: #ffffff;
            --input-border: rgba(0, 0, 0, 0.12);
            --input-text: #0f172a;
            --input-placeholder: rgba(15, 23, 42, 0.5);
        }

        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Header */
        .main-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }

        .logo h1 {
            font-size: 1.25rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-primary);
        }

        .home-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
        }

        .home-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        /* Presets */
        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .preset-card {
            padding: 1.25rem;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .preset-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent-primary);
            box-shadow: 0 4px 12px rgba(0, 166, 81, 0.25);
        }

        .preset-card.active {
            border-color: var(--accent-primary);
            background: rgba(0, 166, 81, 0.1);
        }

        .preset-card.recommended {
            border: 2px solid var(--accent-primary);
        }

        .preset-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .preset-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .preset-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Config Sections */
        .config-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }

        /* Experts Grid */
        .experts-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1200px) {
            .experts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .experts-grid {
                grid-template-columns: 1fr;
            }
        }

        .expert-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
        }

        .expert-card:hover {
            border-color: var(--accent-secondary);
        }

        .expert-card.expert-1 { border-top: 3px solid var(--accent-primary); }
        .expert-card.expert-2 { border-top: 3px solid var(--accent-primary); }
        .expert-card.expert-3 { border-top: 3px solid var(--accent-primary); }
        .expert-card.chairman { border-top: 3px solid var(--accent-secondary); }

        .expert-label {
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .expert-1 .expert-label { color: var(--accent-primary); }
        .expert-2 .expert-label { color: var(--accent-primary); }
        .expert-3 .expert-label { color: var(--accent-primary); }
        .chairman .expert-label { color: var(--accent-secondary); }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }

        .form-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.15);
        }

        .form-group select option {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 0.5rem;
        }

        .strengths-box {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 0.5rem 0.75rem;
            background: rgba(0, 166, 81, 0.1);
            border-radius: 6px;
            margin-top: 0.75rem;
        }

        /* Estimate Box */
        .estimate-box {
            background: var(--accent-gradient);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .estimate-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .estimate-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .estimate-grid {
                grid-template-columns: 1fr;
            }
        }

        .estimate-item {
            background: rgba(255,255,255,0.15);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .estimate-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .estimate-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }

        .warning-box {
            display: none;
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(245, 158, 11, 0.2);
            border-radius: 8px;
            font-size: 0.875rem;
        }

        /* Query Section */
        .query-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 0.95rem;
            color: var(--input-text);
            resize: vertical;
            transition: all 0.2s;
            line-height: 1.6;
        }

        .query-section textarea::placeholder {
            color: var(--input-placeholder);
        }

        .query-section textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.15);
        }

        /* Options Row */
        .options-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .checkbox-label input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        /* Submit Button */
        .btn-submit {
            padding: 1rem 2rem;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.35);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading */
        .loading-box {
            display: none;
            padding: 1.5rem;
            background: var(--warning-bg);
            border-left: 4px solid var(--warning);
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .loading-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .spinner {
            border: 3px solid rgba(245, 158, 11, 0.3);
            border-top-color: var(--warning);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .final-response-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-left: 4px solid var(--success);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--success);
        }

        .result-text {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .result-meta {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(16, 185, 129, 0.2);
            display: flex;
            gap: 2rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Opinions Section */
        .opinions-box {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .opinion-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            overflow-x: auto;
        }

        .opinion-tab {
            padding: 0.75rem 1.25rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
            white-space: nowrap;
        }

        .opinion-tab:hover {
            color: var(--text-primary);
        }

        .opinion-tab.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }

        .opinion-content {
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            line-height: 1.8;
            white-space: pre-wrap;
            color: var(--text-primary);
            max-height: 400px;
            overflow-y: auto;
        }

        /* Error Toast */
        .error-toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--error);
            color: white;
            border-radius: 10px;
            font-size: 0.875rem;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .error-toast.visible {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
    <link rel="stylesheet" href="/apps/shared/iafactory-unified.css">
  <style>

        :root {
            --bg: #020617;
            --bg-alt: #020617;
            --card: #020617;
            --bg-card: #020617;
            --bg-secondary: #0f172a;
            --bg-dark: #020617;
            --border: rgba(255, 255, 255, 0.12);
            --border-primary: rgba(255, 255, 255, 0.12);
            --primary: #00a651;
            --primary-dark: #008c45;
            --accent: #00a651;
            --accent-primary: #00a651;
            --text: #f8fafc;
            --text-primary: #f8fafc;
            --text-secondary: rgba(248, 250, 252, 0.75);
            --muted: rgba(248, 250, 252, 0.75);
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.55);
        }

        [data-theme="light"] {
            --bg: #f7f5f0;
            --bg-alt: #f7f5f0;
            --card: #f7f5f0;
            --bg-card: #ffffff;
            --bg-secondary: #f7f5f0;
            --bg-dark: #f7f5f0;
            --border: rgba(0, 0, 0, 0.08);
            --border-primary: rgba(0, 0, 0, 0.08);
            --primary: #00a651;
            --primary-dark: #008c45;
            --accent: #00a651;
            --accent-primary: #00a651;
            --text: #0f172a;
            --text-primary: #0f172a;
            --text-secondary: rgba(15, 23, 42, 0.7);
            --muted: rgba(15, 23, 42, 0.7);
            --shadow: 0 20px 60px rgba(15, 23, 42, 0.25);
        }
  </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-users"></i>
            </div>
            <h1>Council IA</h1>
        </div>
        <div class="header-actions">
            <button class="theme-toggle" onclick="toggleTheme()" title="Changer le th√®me">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
            <a href="/" class="home-btn">
                <i class="fas fa-home"></i>
                Accueil
            </a>
        </div>
    
                <!-- IAF Unified Controls -->
                <div class="iaf-header-actions" style="display:flex;align-items:center;gap:0.5rem;margin-left:auto;">
                    <div class="iaf-lang-dropdown" style="position:relative;">
                        <button class="iaf-lang-btn" onclick="IAFactory.toggleLangMenu()" style="display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0.75rem;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit;cursor:pointer;font-size:0.85rem;">
                            üåê <span id="iaf-current-lang">FR</span>
                        </button>
                        <div class="iaf-lang-menu" id="iaf-lang-menu" style="position:absolute;top:100%;right:0;margin-top:4px;background:var(--bg-card,#1a1a2e);border:1px solid rgba(255,255,255,0.1);border-radius:12px;box-shadow:0 15px 30px rgba(0,0,0,0.3);display:none;min-width:150px;z-index:1001;overflow:hidden;">
                            <button class="iaf-lang-option" onclick="IAFactory.setLanguage('fr')" style="display:flex;align-items:center;gap:0.5rem;width:100%;padding:0.75rem 1rem;border:none;background:transparent;color:inherit;cursor:pointer;text-align:left;">üá´üá∑ Fran√ßais</button>
                            <button class="iaf-lang-option" onclick="IAFactory.setLanguage('en')" style="display:flex;align-items:center;gap:0.5rem;width:100%;padding:0.75rem 1rem;border:none;background:transparent;color:inherit;cursor:pointer;text-align:left;">üá¨üáß English</button>
                            <button class="iaf-lang-option" onclick="IAFactory.setLanguage('ar')" style="display:flex;align-items:center;gap:0.5rem;width:100%;padding:0.75rem 1rem;border:none;background:transparent;color:inherit;cursor:pointer;text-align:left;">üá©üáø ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
                        </div>
                    </div>
                    <button class="iaf-theme-btn" onclick="IAFactory.toggleTheme()" id="iaf-theme-btn" style="width:40px;height:40px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit;cursor:pointer;font-size:1.1rem;">‚òÄÔ∏è</button>
                </div>

            </header>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>üéØ Build Your Council</h1>
            <p>Composez votre √©quipe d'experts IA sur mesure avec une infinit√© de combinaisons</p>
        </div>

        <!-- Presets -->
        <div class="config-section">
            <h2 class="section-title">‚ú® Configurations recommand√©es (Groq ‚ö° + OpenRouter üåê)</h2>
            <div class="presets-grid" id="presetsGrid">
                <div class="preset-card recommended" onclick="applyPreset('fast')">
                    <div class="preset-icon">‚ö°</div>
                    <div class="preset-name">Groq Diversifi√© ‚≠ê</div>
                    <div class="preset-desc">Llama 70B + Qwen + Kimi</div>
                </div>
                <div class="preset-card recommended" onclick="applyPreset('deepseek')">
                    <div class="preset-icon">üá®üá≥</div>
                    <div class="preset-name">DeepSeek Power ‚≠ê</div>
                    <div class="preset-desc">Chat + R1 Reasoner</div>
                </div>
                <div class="preset-card" onclick="applyPreset('diversified')">
                    <div class="preset-icon">üéØ</div>
                    <div class="preset-name">Mix Groq+DeepSeek</div>
                    <div class="preset-desc">Llama + Kimi + DeepSeek</div>
                </div>
                <div class="preset-card" onclick="applyPreset('llama4')">
                    <div class="preset-icon">ü¶ô</div>
                    <div class="preset-name">Llama 4 Meta</div>
                    <div class="preset-desc">Maverick + Scout + 70B</div>
                </div>
                <div class="preset-card" onclick="applyPreset('openrouter')">
                    <div class="preset-icon">üåê</div>
                    <div class="preset-name">OpenRouter FREE</div>
                    <div class="preset-desc">Gemini + Llama + Mistral</div>
                </div>
                <div class="preset-card" onclick="applyPreset('hybrid')">
                    <div class="preset-icon">üîÄ</div>
                    <div class="preset-name">Hybride</div>
                    <div class="preset-desc">Groq + Gemini + Qwen</div>
                </div>
                <div class="preset-card" onclick="applyPreset('local')">
                    <div class="preset-icon">üè†</div>
                    <div class="preset-name">100% Local</div>
                    <div class="preset-desc">Ollama (lent sur VPS)</div>
                </div>
            </div>
        </div>

        <!-- Configuration -->
        <div class="config-section">
            <h2 class="section-title">‚öôÔ∏è Configuration du Council</h2>
            
            <div class="experts-grid">
                <!-- Expert 1 -->
                <div class="expert-card expert-1">
                    <div class="expert-label">
                        <i class="fas fa-user-tie"></i> Expert 1
                    </div>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="provider1" onchange="onProviderChange(1)">
                            <option value="deepseek">üá®üá≥ DeepSeek (√âconomique)</option>
                            <option value="groq" selected>‚ö° Groq (Ultra-rapide)</option>
                            <option value="openrouter">üåê OpenRouter</option>
                            <option value="ollama">üè† Ollama (Local)</option>
                            <option value="openai">ü§ñ OpenAI (ChatGPT)</option>
                            <option value="anthropic">üé≠ Anthropic (Claude)</option>
                            <option value="perplexity">üîç Perplexity</option>
                            <option value="grok">üöÄ Grok (xAI)</option>
                            <option value="mistral">üá´üá∑ Mistral</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mod√®le</label>
                        <select id="model1"></select>
                    </div>
                    <div class="strengths-box" id="strengths1">üí™ S√©lectionnez un mod√®le</div>
                </div>

                <!-- Expert 2 -->
                <div class="expert-card expert-2">
                    <div class="expert-label">
                        <i class="fas fa-user-tie"></i> Expert 2
                    </div>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="provider2" onchange="onProviderChange(2)">
                            <option value="deepseek">üá®üá≥ DeepSeek (√âconomique)</option>
                            <option value="groq" selected>‚ö° Groq (Ultra-rapide)</option>
                            <option value="openrouter">üåê OpenRouter</option>
                            <option value="ollama">üè† Ollama (Local)</option>
                            <option value="openai">ü§ñ OpenAI (ChatGPT)</option>
                            <option value="anthropic">üé≠ Anthropic (Claude)</option>
                            <option value="perplexity">üîç Perplexity</option>
                            <option value="grok">üöÄ Grok (xAI)</option>
                            <option value="mistral">üá´üá∑ Mistral</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mod√®le</label>
                        <select id="model2"></select>
                    </div>
                    <div class="strengths-box" id="strengths2">üí™ S√©lectionnez un mod√®le</div>
                </div>

                <!-- Expert 3 -->
                <div class="expert-card expert-3">
                    <div class="expert-label">
                        <i class="fas fa-user-tie"></i> Expert 3
                    </div>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="provider3" onchange="onProviderChange(3)">
                            <option value="deepseek">üá®üá≥ DeepSeek (√âconomique)</option>
                            <option value="groq" selected>‚ö° Groq (Ultra-rapide)</option>
                            <option value="openrouter">üåê OpenRouter</option>
                            <option value="ollama">üè† Ollama (Local)</option>
                            <option value="openai">ü§ñ OpenAI (ChatGPT)</option>
                            <option value="anthropic">üé≠ Anthropic (Claude)</option>
                            <option value="perplexity">üîç Perplexity</option>
                            <option value="grok">üöÄ Grok (xAI)</option>
                            <option value="mistral">üá´üá∑ Mistral</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mod√®le</label>
                        <select id="model3"></select>
                    </div>
                    <div class="strengths-box" id="strengths3">üí™ S√©lectionnez un mod√®le</div>
                </div>

                <!-- Chairman -->
                <div class="expert-card chairman">
                    <div class="expert-label">
                        <i class="fas fa-crown"></i> Chairman (Synth√®se)
                    </div>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="providerChairman" onchange="onProviderChange('Chairman')">
                            <option value="deepseek">üá®üá≥ DeepSeek (√âconomique)</option>
                            <option value="groq" selected>‚ö° Groq (Ultra-rapide)</option>
                            <option value="openrouter">üåê OpenRouter</option>
                            <option value="ollama">üè† Ollama (Local)</option>
                            <option value="openai">ü§ñ OpenAI (ChatGPT)</option>
                            <option value="anthropic">üé≠ Anthropic (Claude)</option>
                            <option value="perplexity">üîç Perplexity</option>
                            <option value="grok">üöÄ Grok (xAI)</option>
                            <option value="mistral">üá´üá∑ Mistral</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mod√®le</label>
                        <select id="modelChairman"></select>
                    </div>
                    <div class="strengths-box" id="strengthsChairman">üí™ S√©lectionnez un mod√®le</div>
                </div>
            </div>
        </div>

        <!-- Estimation -->
        <div class="estimate-box">
            <div class="estimate-title">üìä Estimation</div>
            <div class="estimate-grid">
                <div class="estimate-item">
                    <div class="estimate-label">üí∞ Co√ªt estim√©</div>
                    <div class="estimate-value" id="costEstimate">~50 DZD</div>
                </div>
                <div class="estimate-item">
                    <div class="estimate-label">‚è±Ô∏è Temps estim√©</div>
                    <div class="estimate-value" id="timeEstimate">~15s</div>
                </div>
                <div class="estimate-item">
                    <div class="estimate-label">üéØ Combinaisons</div>
                    <div class="estimate-value">‚àû</div>
                </div>
            </div>
            <div class="warning-box" id="warningBox">
                ‚ö†Ô∏è Configuration premium : co√ªt √©lev√©. Utilisez Groq pour r√©duire les co√ªts.
            </div>
        </div>

        <!-- Query Section -->
        <div class="config-section query-section">
            <h2 class="section-title">üí¨ Votre question</h2>
            <textarea 
                id="queryInput" 
                placeholder="Posez votre question au Council personnalis√©...

Exemples:
‚Ä¢ Quelles sont les meilleures pratiques pour s√©curiser une API REST ?
‚Ä¢ Comment optimiser PostgreSQL pour des millions de lignes ?
‚Ä¢ Expliquez la diff√©rence entre authentification et autorisation
‚Ä¢ Compare les architectures microservices vs monolithique"
            ></textarea>
            
            <div class="options-row">
                <label class="checkbox-label">
                    <input type="checkbox" id="enableReview">
                    <span>Activer la revue crois√©e (+50% temps, meilleure qualit√©)</span>
                </label>
                <button class="btn-submit" id="submitBtn" onclick="executeCouncil()">
                    <i class="fas fa-bolt"></i>
                    Lancer le Council
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading-box" id="loadingBox">
            <div class="loading-content">
                <div class="spinner"></div>
                <div>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">Council en d√©lib√©ration...</div>
                    <div style="font-size: 0.875rem; color: var(--text-secondary);" id="loadingStatus">Les experts analysent votre question</div>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div class="results-section" id="resultsSection">
            <div class="final-response-box">
                <div class="result-header">
                    <i class="fas fa-crown"></i>
                    <span>R√©ponse finale du Chairman</span>
                    <span id="chairmanName" style="font-size: 0.9rem; font-weight: normal; color: var(--text-secondary);"></span>
                </div>
                <div class="result-text" id="finalResponse"></div>
                <div class="result-meta">
                    <span id="execTime"><i class="fas fa-clock"></i> -</span>
                    <span id="actualCost"><i class="fas fa-coins"></i> -</span>
                    <span id="expertsCount"><i class="fas fa-users"></i> -</span>
                </div>
            </div>

            <div class="opinions-box">
                <h3 class="section-title">üéØ Opinions individuelles des experts</h3>
                <div class="opinion-tabs" id="opinionTabs"></div>
                <div class="opinion-content" id="opinionContent">S√©lectionnez un expert pour voir son opinion</div>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="error-toast" id="errorToast">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorMessage"></span>
    </div>

    <script>
        // ============================================
        // Provider and Model Configuration
        // ============================================
        // API Keys pour appels directs
        // ============================================
        const OPENROUTER_API_KEY = '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';
        const GROQ_API_KEY = 'YOUR_GROQ_API_KEY';
        const DEEPSEEK_API_KEY = 'sk-e2d7d214600946479856ffafbe1ce392';
        const OPENAI_API_KEY = 'YOUR_OPENAI_API_KEY';
        const ANTHROPIC_API_KEY = 'YOUR_ANTHROPIC_API_KEY';
        const MISTRAL_API_KEY = 'U4TD40GfA96d4txjFQzQSps2PXaxKYHC';
        const GOOGLE_API_KEY = 'AIzaSyB21Sv2aZEJ33TJ02dfLMx-PklP4ZVcG40';
        const COHERE_API_KEY = 'bAVVqL7U4wv2gmd4gbGBQwpVXDEGZqFm42czSg3a';
        const TOGETHER_API_KEY = '99ac6265846d3cb6a8f83e038605d01a4d1c6b8b80e4a64d3486460a89b85df3';
        const PERPLEXITY_API_KEY = 'YOUR_PERPLEXITY_API_KEY';
        const GROK_API_KEY = 'YOUR_XAI_API_KEY';
        
        // APIs M√©dia (Vid√©o/Avatar)
        const DID_API_KEY = 'YmVuc2FsZW1ib3VhbGVtQGdtYWlsLmNvbQ:XDqHY1ZQh9pWKHviJqMed';

        const PROVIDERS = {
            deepseek: {
                name: 'DeepSeek üá®üá≥',
                models: [
                    { id: 'deepseek.deepseek-chat', name: 'DeepSeek Chat V3', strengths: ['√âconomique', 'Raisonnement', 'Code'], cost: 1 },
                    { id: 'deepseek.deepseek-reasoner', name: 'DeepSeek R1 üß†', strengths: ['Raisonnement avanc√©', 'Math', 'Logique'], cost: 3 }
                ]
            },
            groq: {
                name: 'Groq ‚ö°',
                models: [
                    { id: 'groq.llama-3.3-70b-versatile', name: 'Llama 3.3 70B', strengths: ['Puissant', 'Versatile', '131K ctx'], cost: 0 },
                    { id: 'groq.llama-3.1-8b-instant', name: 'Llama 3.1 8B', strengths: ['Ultra-rapide', 'Gratuit'], cost: 0 },
                    { id: 'groq.moonshotai/kimi-k2-instruct', name: 'Kimi K2 üåô', strengths: ['Moonshot AI', 'Raisonnement'], cost: 0 },
                    { id: 'groq.qwen/qwen3-32b', name: 'Qwen3 32B', strengths: ['Alibaba', 'Multilingue', 'Code'], cost: 0 },
                    { id: 'groq.meta-llama/llama-4-maverick-17b-128e-instruct', name: 'Llama 4 Maverick ü¶ô', strengths: ['Meta', 'Nouveau', '131K ctx'], cost: 0 },
                    { id: 'groq.meta-llama/llama-4-scout-17b-16e-instruct', name: 'Llama 4 Scout ü¶ô', strengths: ['Meta', 'Exploration'], cost: 0 },
                    { id: 'groq.openai/gpt-oss-120b', name: 'GPT-OSS 120B', strengths: ['OpenAI OSS', 'Tr√®s puissant'], cost: 0 },
                    { id: 'groq.openai/gpt-oss-20b', name: 'GPT-OSS 20B', strengths: ['OpenAI OSS', 'Rapide'], cost: 0 },
                    { id: 'groq.allam-2-7b', name: 'Allam 2 7B üá∏üá¶', strengths: ['Arabe natif', 'SDAIA'], cost: 0 }
                ]
            },
            openrouter: {
                name: 'OpenRouter üåê',
                models: [
                    { id: 'openrouter.google/gemini-2.0-flash-exp:free', name: 'Gemini 2.0 Flash (Free)', strengths: ['Gratuit', 'Google', 'Rapide'], cost: 0 },
                    { id: 'openrouter.meta-llama/llama-3.2-3b-instruct:free', name: 'Llama 3.2 3B (Free)', strengths: ['Gratuit', 'Meta', 'Compact'], cost: 0 },
                    { id: 'openrouter.mistralai/mistral-7b-instruct:free', name: 'Mistral 7B (Free)', strengths: ['Gratuit', 'FR natif'], cost: 0 },
                    { id: 'openrouter.deepseek/deepseek-chat', name: 'DeepSeek Chat üá®üá≥', strengths: ['√âconomique', 'Code', 'Raisonnement'], cost: 2 },
                    { id: 'openrouter.deepseek/deepseek-r1', name: 'DeepSeek R1 üß†', strengths: ['Raisonnement avanc√©', 'Math'], cost: 5 },
                    { id: 'openrouter.qwen/qwen-2.5-72b-instruct', name: 'Qwen 2.5 72B', strengths: ['Alibaba', 'Puissant'], cost: 10 },
                    { id: 'openrouter.anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonnet', strengths: ['Anthropic', '√âcriture'], cost: 15 },
                    { id: 'openrouter.openai/gpt-4o-mini', name: 'GPT-4o Mini', strengths: ['OpenAI', 'Rapide'], cost: 5 },
                    { id: 'openrouter.openai/gpt-4o', name: 'GPT-4o', strengths: ['OpenAI', 'Meilleur'], cost: 25 }
                ]
            },
            ollama: {
                name: 'Ollama üè† (lent)',
                models: [
                    { id: 'ollama.llama3.2:3b', name: 'Llama 3.2 3B', strengths: ['Local', 'Priv√©', 'Rapide'], cost: 0 },
                    { id: 'ollama.mistral:7b', name: 'Mistral 7B', strengths: ['Local', 'FR natif', '√âquilibr√©'], cost: 0 },
                    { id: 'ollama.qwen2.5:3b', name: 'Qwen 2.5 3B', strengths: ['Local', 'Multilingue', 'Compact'], cost: 0 }
                ]
            },
            // ============ PROVIDERS PREMIUM (n√©cessitent cl√© API) ============
            openai: {
                name: 'OpenAI ü§ñ (ChatGPT)',
                models: [
                    { id: 'openai.gpt-4o', name: 'GPT-4o', strengths: ['Meilleur', 'Multimodal', '128K ctx'], cost: 25 },
                    { id: 'openai.gpt-4o-mini', name: 'GPT-4o Mini', strengths: ['Rapide', '√âconomique'], cost: 5 },
                    { id: 'openai.gpt-4-turbo', name: 'GPT-4 Turbo', strengths: ['Puissant', '128K ctx'], cost: 30 },
                    { id: 'openai.gpt-4', name: 'GPT-4', strengths: ['Original', 'Stable'], cost: 30 },
                    { id: 'openai.gpt-3.5-turbo', name: 'GPT-3.5 Turbo', strengths: ['√âconomique', 'Rapide'], cost: 2 },
                    { id: 'openai.o1-preview', name: 'O1 Preview üß†', strengths: ['Raisonnement', 'Math', 'Code'], cost: 60 },
                    { id: 'openai.o1-mini', name: 'O1 Mini üß†', strengths: ['Raisonnement', '√âconomique'], cost: 12 }
                ]
            },
            anthropic: {
                name: 'Anthropic üé≠ (Claude)',
                models: [
                    { id: 'anthropic.claude-3-5-sonnet-20241022', name: 'Claude 3.5 Sonnet', strengths: ['Meilleur', 'Code', '√âcriture'], cost: 15 },
                    { id: 'anthropic.claude-3-5-haiku-20241022', name: 'Claude 3.5 Haiku', strengths: ['Rapide', '√âconomique'], cost: 4 },
                    { id: 'anthropic.claude-3-opus-20240229', name: 'Claude 3 Opus', strengths: ['Tr√®s puissant', 'Analyse'], cost: 75 },
                    { id: 'anthropic.claude-3-sonnet-20240229', name: 'Claude 3 Sonnet', strengths: ['√âquilibr√©', 'Versatile'], cost: 15 },
                    { id: 'anthropic.claude-3-haiku-20240307', name: 'Claude 3 Haiku', strengths: ['Ultra-rapide', 'Compact'], cost: 1 }
                ]
            },
            perplexity: {
                name: 'Perplexity üîç',
                models: [
                    { id: 'perplexity.llama-3.1-sonar-large-128k-online', name: 'Sonar Large Online', strengths: ['Recherche web', 'Temps r√©el', '128K'], cost: 5 },
                    { id: 'perplexity.llama-3.1-sonar-small-128k-online', name: 'Sonar Small Online', strengths: ['Recherche web', '√âconomique'], cost: 2 },
                    { id: 'perplexity.llama-3.1-sonar-huge-128k-online', name: 'Sonar Huge Online', strengths: ['Le plus puissant', 'Recherche'], cost: 20 },
                    { id: 'perplexity.llama-3.1-sonar-large-128k-chat', name: 'Sonar Large Chat', strengths: ['Sans recherche', 'Rapide'], cost: 3 },
                    { id: 'perplexity.llama-3.1-sonar-small-128k-chat', name: 'Sonar Small Chat', strengths: ['Sans recherche', '√âconomique'], cost: 1 }
                ]
            },
            grok: {
                name: 'Grok üöÄ (xAI)',
                models: [
                    { id: 'grok.grok-beta', name: 'Grok Beta', strengths: ['Nouveau', 'Humour', 'Temps r√©el'], cost: 10 },
                    { id: 'grok.grok-2-1212', name: 'Grok 2', strengths: ['Derni√®re version', 'Puissant'], cost: 15 },
                    { id: 'grok.grok-2-vision-1212', name: 'Grok 2 Vision', strengths: ['Multimodal', 'Images'], cost: 20 }
                ]
            },
            mistral: {
                name: 'Mistral üá´üá∑',
                models: [
                    { id: 'mistral.mistral-large-latest', name: 'Mistral Large', strengths: ['Le meilleur', 'FR natif', '128K'], cost: 12 },
                    { id: 'mistral.mistral-medium-latest', name: 'Mistral Medium', strengths: ['√âquilibr√©', 'Polyvalent'], cost: 8 },
                    { id: 'mistral.mistral-small-latest', name: 'Mistral Small', strengths: ['Rapide', '√âconomique'], cost: 3 },
                    { id: 'mistral.open-mistral-nemo', name: 'Mistral Nemo', strengths: ['128K ctx', 'Multilingue'], cost: 2 },
                    { id: 'mistral.codestral-latest', name: 'Codestral', strengths: ['Code', 'Programmation'], cost: 3 },
                    { id: 'mistral.ministral-8b-latest', name: 'Ministral 8B', strengths: ['Compact', 'Edge'], cost: 1 },
                    { id: 'mistral.ministral-3b-latest', name: 'Ministral 3B', strengths: ['Ultra-compact', 'Rapide'], cost: 0.5 },
                    { id: 'mistral.pixtral-large-latest', name: 'Pixtral Large', strengths: ['Vision', 'Images'], cost: 15 }
                ]
            }
        };

        // NOTE: ‚ö° = Groq ultra-rapide, üåê = OpenRouter (gratuit/payant), üè† = Local (lent sur VPS)

        const PRESETS = {
            openrouter: {
                name: 'OpenRouter Free',
                experts: [
                    { provider: 'openrouter', model: 'openrouter.google/gemini-2.0-flash-exp:free' },
                    { provider: 'openrouter', model: 'openrouter.meta-llama/llama-3.2-3b-instruct:free' },
                    { provider: 'openrouter', model: 'openrouter.mistralai/mistral-7b-instruct:free' }
                ],
                chairman: { provider: 'openrouter', model: 'openrouter.google/gemini-2.0-flash-exp:free' }
            },
            fast: {
                name: 'Groq Ultra Rapide',
                experts: [
                    { provider: 'groq', model: 'groq.llama-3.3-70b-versatile' },
                    { provider: 'groq', model: 'groq.qwen/qwen3-32b' },
                    { provider: 'groq', model: 'groq.moonshotai/kimi-k2-instruct' }
                ],
                chairman: { provider: 'groq', model: 'groq.llama-3.3-70b-versatile' }
            },
            diversified: {
                name: 'Diversifi√©',
                experts: [
                    { provider: 'groq', model: 'groq.llama-3.3-70b-versatile' },
                    { provider: 'groq', model: 'groq.moonshotai/kimi-k2-instruct' },
                    { provider: 'deepseek', model: 'deepseek.deepseek-chat' }
                ],
                chairman: { provider: 'deepseek', model: 'deepseek.deepseek-reasoner' }
            },
            deepseek: {
                name: 'DeepSeek Power üá®üá≥',
                experts: [
                    { provider: 'deepseek', model: 'deepseek.deepseek-chat' },
                    { provider: 'deepseek', model: 'deepseek.deepseek-reasoner' },
                    { provider: 'groq', model: 'groq.llama-3.3-70b-versatile' }
                ],
                chairman: { provider: 'deepseek', model: 'deepseek.deepseek-reasoner' }
            },
            llama4: {
                name: 'Llama 4 ü¶ô',
                experts: [
                    { provider: 'groq', model: 'groq.meta-llama/llama-4-maverick-17b-128e-instruct' },
                    { provider: 'groq', model: 'groq.meta-llama/llama-4-scout-17b-16e-instruct' },
                    { provider: 'groq', model: 'groq.llama-3.3-70b-versatile' }
                ],
                chairman: { provider: 'groq', model: 'groq.meta-llama/llama-4-maverick-17b-128e-instruct' }
            },
            hybrid: {
                name: 'Hybride',
                experts: [
                    { provider: 'groq', model: 'groq.llama-3.3-70b-versatile' },
                    { provider: 'openrouter', model: 'openrouter.google/gemini-2.0-flash-exp:free' },
                    { provider: 'groq', model: 'groq.qwen/qwen3-32b' }
                ],
                chairman: { provider: 'groq', model: 'groq.moonshotai/kimi-k2-instruct' }
            },
            local: {
                name: '100% Local',
                experts: [
                    { provider: 'ollama', model: 'ollama.llama3.2:3b' },
                    { provider: 'ollama', model: 'ollama.mistral:7b' },
                    { provider: 'ollama', model: 'ollama.qwen2.5:3b' }
                ],
                chairman: { provider: 'ollama', model: 'ollama.mistral:7b' }
            }
        };

        let currentOpinions = {};

        // ============================================
        // Initialization
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Load theme
            const savedTheme = localStorage.getItem('council-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);

            // Initialize all expert selects
            [1, 2, 3, 'Chairman'].forEach(num => {
                onProviderChange(num);
            });

            updateEstimate();
        });

        // ============================================
        // Theme Toggle
        // ============================================

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            icon.className = theme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
        }

        // ============================================
        // Provider/Model Management
        // ============================================
        function onProviderChange(expertNum) {
            const providerSelect = document.getElementById(`provider${expertNum}`);
            const modelSelect = document.getElementById(`model${expertNum}`);
            const strengthsBox = document.getElementById(`strengths${expertNum}`);
            
            const provider = providerSelect.value;
            const models = PROVIDERS[provider].models;

            // Populate models
            modelSelect.innerHTML = models.map(m => 
                `<option value="${m.id}">${m.name}</option>`
            ).join('');

            // Update strengths
            updateStrengths(expertNum);
            
            // Add change listener to model
            modelSelect.onchange = () => updateStrengths(expertNum);

            updateEstimate();
        }

        function updateStrengths(expertNum) {
            const providerSelect = document.getElementById(`provider${expertNum}`);
            const modelSelect = document.getElementById(`model${expertNum}`);
            const strengthsBox = document.getElementById(`strengths${expertNum}`);

            const provider = providerSelect.value;
            const modelId = modelSelect.value;
            const model = PROVIDERS[provider].models.find(m => m.id === modelId);

            if (model) {
                strengthsBox.textContent = `üí™ ${model.strengths.join(', ')}`;
            }

            updateEstimate();
        }

        // ============================================
        // Presets
        // ============================================
        function applyPreset(presetName) {
            const preset = PRESETS[presetName];
            
            // Update presets UI
            document.querySelectorAll('.preset-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Apply expert configs
            preset.experts.forEach((exp, idx) => {
                const num = idx + 1;
                document.getElementById(`provider${num}`).value = exp.provider;
                onProviderChange(num);
                document.getElementById(`model${num}`).value = exp.model;
                updateStrengths(num);
            });

            // Apply chairman config
            document.getElementById('providerChairman').value = preset.chairman.provider;
            onProviderChange('Chairman');
            document.getElementById('modelChairman').value = preset.chairman.model;
            updateStrengths('Chairman');

            updateEstimate();
        }

        // ============================================
        // Estimation
        // ============================================
        function updateEstimate() {
            let totalCost = 0;
            let fastestTime = true;

            [1, 2, 3, 'Chairman'].forEach(num => {
                const provider = document.getElementById(`provider${num}`).value;
                const modelId = document.getElementById(`model${num}`).value;
                const model = PROVIDERS[provider]?.models.find(m => m.id === modelId);
                
                if (model) {
                    totalCost += model.cost;
                    if (provider !== 'groq') fastestTime = false;
                }
            });

            const enableReview = document.getElementById('enableReview').checked;
            if (enableReview) {
                totalCost *= 1.5;
            }

            // Update UI
            document.getElementById('costEstimate').textContent = totalCost === 0 ? 'Gratuit!' : `~${Math.round(totalCost)} DZD`;
            document.getElementById('timeEstimate').textContent = fastestTime ? '~5s' : (enableReview ? '~30s' : '~15s');
            
            // Show warning for expensive configs
            document.getElementById('warningBox').style.display = totalCost > 100 ? 'block' : 'none';
        }

        // ============================================
        // Execute Council
        // ============================================
        async function executeCouncil() {
            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                showError('Veuillez entrer une question');
                return;
            }

            // Get configuration
            const experts = [1, 2, 3].map(num => ({
                provider: document.getElementById(`provider${num}`).value,
                model: document.getElementById(`model${num}`).value
            }));
            
            const chairman = {
                provider: document.getElementById('providerChairman').value,
                model: document.getElementById('modelChairman').value
            };

            const enableReview = document.getElementById('enableReview').checked;

            // Show loading
            document.getElementById('loadingBox').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('submitBtn').disabled = true;

            const startTime = Date.now();

            try {
                // Call each expert in parallel
                document.getElementById('loadingStatus').textContent = 'Les experts analysent votre question...';
                
                // Detect language of input for instruction
                const langInstruction = '\n\n[IMPORTANT: Respond in the SAME language as the question above. If the question is in French, answer in French. If in English, answer in English. If in Arabic, answer in Arabic.]';
                
                const expertPromises = experts.map((exp, idx) => 
                    callLLM(exp.model, query + langInstruction, `Expert ${idx + 1}`)
                );

                const expertResponses = await Promise.all(expertPromises);

                // Store opinions
                currentOpinions = {};
                expertResponses.forEach((response, idx) => {
                    currentOpinions[`expert${idx + 1}`] = response;
                });

                // Chairman synthesis
                document.getElementById('loadingStatus').textContent = 'Le Chairman synth√©tise les r√©ponses...';
                
                const synthesisPrompt = `You are the Chairman of an AI expert council. 
Here is the question asked: "${query}"

Here are the expert opinions:

Expert 1 (${getModelName(experts[0].model)}):
${expertResponses[0]}

Expert 2 (${getModelName(experts[1].model)}):
${expertResponses[1]}

Expert 3 (${getModelName(experts[2].model)}):
${expertResponses[2]}

As Chairman, provide a comprehensive synthesis that:
1. Identifies points of consensus
2. Notes unique perspectives from each expert
3. Proposes a balanced and complete final answer

CRITICAL: You MUST respond in the SAME LANGUAGE as the original question. If the question is in French, respond entirely in French. If in English, respond in English. If in Arabic, respond in Arabic. Match the language exactly.`;

                const finalResponse = await callLLM(chairman.model, synthesisPrompt, 'Chairman');

                // Calculate stats
                const execTime = ((Date.now() - startTime) / 1000).toFixed(1);

                // Display results
                displayResults({
                    finalResponse,
                    chairman,
                    experts,
                    execTime,
                    opinions: currentOpinions
                });

            } catch (error) {
                showError(`Erreur: ${error.message}`);
            } finally {
                document.getElementById('loadingBox').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
            }
        }

        async function callLLM(model, prompt, role) {
            try {
                // Check if it's an Ollama model
                if (model.startsWith('ollama.')) {
                    return await callOllama(model, prompt, role);
                }

                // Check if it's an OpenRouter model
                if (model.startsWith('openrouter.')) {
                    return await callOpenRouter(model, prompt, role);
                }

                // Check if it's a Groq model - call directly
                if (model.startsWith('groq.')) {
                    return await callGroq(model, prompt, role);
                }

                // Check if it's a DeepSeek model - call directly
                if (model.startsWith('deepseek.')) {
                    return await callDeepSeek(model, prompt, role);
                }

                // Check if it's an OpenAI/ChatGPT model
                if (model.startsWith('openai.')) {
                    return await callOpenAI(model, prompt, role);
                }

                // Check if it's an Anthropic/Claude model
                if (model.startsWith('anthropic.')) {
                    return await callAnthropic(model, prompt, role);
                }

                // Check if it's a Perplexity model
                if (model.startsWith('perplexity.')) {
                    return await callPerplexity(model, prompt, role);
                }

                // Check if it's a Grok/xAI model
                if (model.startsWith('grok.')) {
                    return await callGrok(model, prompt, role);
                }

                // Check if it's a Mistral model
                if (model.startsWith('mistral.')) {
                    return await callMistral(model, prompt, role);
                }

                // Standard API call for other providers (fallback)
                const systemPrompt = 'You MUST respond in the same language as the user input. If the user writes in French, respond in French. If in English, respond in English. Match the language exactly.';
                const response = await fetch('/api/llm/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: prompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();
                
                if (!response.ok || !data.success) {
                    let errorMsg = 'Erreur inconnue';
                    if (typeof data.detail === 'string') {
                        errorMsg = data.detail;
                    } else if (typeof data.error === 'string') {
                        errorMsg = data.error;
                    } else if (data.detail && typeof data.detail === 'object') {
                        errorMsg = JSON.stringify(data.detail);
                    } else if (data.error && typeof data.error === 'object') {
                        errorMsg = JSON.stringify(data.error);
                    }
                    throw new Error(`${role}: ${errorMsg}`);
                }

                return data.answer || data.response || 'R√©ponse vide';
            } catch (fetchError) {
                if (fetchError.message.includes(role)) {
                    throw fetchError;
                }
                throw new Error(`${role}: ${fetchError.message}`);
            }
        }

        async function callOllama(model, prompt, role) {
            // Extract actual model name (e.g., "ollama.mistral:7b" -> "mistral:7b")
            const ollamaModel = model.replace('ollama.', '');
            const systemPrompt = 'You MUST respond in the same language as the user input. Match the language exactly.';
            
            try {
                const response = await fetch('/ollama/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: ollamaModel,
                        prompt: prompt,
                        system: systemPrompt,
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                return data.response || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (Ollama): ${error.message}`);
            }
        }

        async function callOpenRouter(model, prompt, role) {
            // Extract actual model name (e.g., "openrouter.deepseek/deepseek-chat" -> "deepseek/deepseek-chat")
            const openrouterModel = model.replace('openrouter.', '');
            
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'IAFactory Council'
                    },
                    body: JSON.stringify({
                        model: openrouterModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. Match the language exactly.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (OpenRouter): ${error.message}`);
            }
        }

        async function callGroq(model, prompt, role) {
            // Extract actual model name (e.g., "groq.llama-3.3-70b-versatile" -> "llama-3.3-70b-versatile")
            const groqModel = model.replace('groq.', '');
            
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: groqModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. Match the language exactly.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (Groq): ${error.message}`);
            }
        }

        async function callDeepSeek(model, prompt, role) {
            // Extract actual model name (e.g., "deepseek.deepseek-chat" -> "deepseek-chat")
            const deepseekModel = model.replace('deepseek.', '');
            
            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: deepseekModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. If the user writes in French, respond in French. If in English, respond in English. Never respond in Chinese unless the user writes in Chinese.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (DeepSeek): ${error.message}`);
            }
        }

        // ============================================
        // OpenAI / ChatGPT API
        // ============================================
        async function callOpenAI(model, prompt, role) {
            if (!OPENAI_API_KEY) {
                throw new Error('Cl√© API OpenAI non configur√©e. Ajoutez votre cl√© dans OPENAI_API_KEY');
            }
            const openaiModel = model.replace('openai.', '');
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: openaiModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. Match the language exactly.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (OpenAI): ${error.message}`);
            }
        }

        // ============================================
        // Anthropic / Claude API
        // ============================================
        async function callAnthropic(model, prompt, role) {
            if (!ANTHROPIC_API_KEY) {
                throw new Error('Cl√© API Anthropic non configur√©e. Ajoutez votre cl√© dans ANTHROPIC_API_KEY');
            }
            const claudeModel = model.replace('anthropic.', '');
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': ANTHROPIC_API_KEY,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: claudeModel,
                        max_tokens: 2000,
                        system: 'You MUST respond in the same language as the user input. Match the language exactly.',
                        messages: [
                            { role: 'user', content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.content?.[0]?.text || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (Claude): ${error.message}`);
            }
        }

        // ============================================
        // Perplexity API
        // ============================================
        async function callPerplexity(model, prompt, role) {
            if (!PERPLEXITY_API_KEY) {
                throw new Error('Cl√© API Perplexity non configur√©e. Ajoutez votre cl√© dans PERPLEXITY_API_KEY');
            }
            const perplexityModel = model.replace('perplexity.', '');
            
            try {
                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${PERPLEXITY_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: perplexityModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. Match the language exactly.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (Perplexity): ${error.message}`);
            }
        }

        // ============================================
        // Grok / xAI API
        // ============================================
        async function callGrok(model, prompt, role) {
            if (!GROK_API_KEY) {
                throw new Error('Cl√© API Grok/xAI non configur√©e. Ajoutez votre cl√© dans GROK_API_KEY');
            }
            const grokModel = model.replace('grok.', '');
            
            try {
                const response = await fetch('https://api.x.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: grokModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. Match the language exactly.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (Grok): ${error.message}`);
            }
        }

        // ============================================
        // Mistral API
        // ============================================
        async function callMistral(model, prompt, role) {
            if (!MISTRAL_API_KEY) {
                throw new Error('Cl√© API Mistral non configur√©e. Ajoutez votre cl√© dans MISTRAL_API_KEY');
            }
            const mistralModel = model.replace('mistral.', '');
            
            try {
                const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MISTRAL_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: mistralModel,
                        messages: [
                            { role: 'system', content: 'You MUST respond in the same language as the user input. Match the language exactly.' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error?.message || `HTTP ${response.status}`;
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || 'R√©ponse vide';
            } catch (error) {
                throw new Error(`${role} (Mistral): ${error.message}`);
            }
        }

        function getModelName(modelId) {
            for (const provider of Object.values(PROVIDERS)) {
                const model = provider.models.find(m => m.id === modelId);
                if (model) return model.name;
            }
            return modelId;
        }

        // ============================================
        // Display Results
        // ============================================
        function displayResults(data) {
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('finalResponse').textContent = data.finalResponse;
            document.getElementById('chairmanName').textContent = `(${getModelName(data.chairman.model)})`;
            document.getElementById('execTime').innerHTML = `<i class="fas fa-clock"></i> ${data.execTime}s`;
            document.getElementById('actualCost').innerHTML = `<i class="fas fa-coins"></i> Estim√©`;
            document.getElementById('expertsCount').innerHTML = `<i class="fas fa-users"></i> 3 experts + Chairman`;

            // Build opinion tabs
            const tabsHTML = data.experts.map((exp, idx) => `
                <button class="opinion-tab ${idx === 0 ? 'active' : ''}" 
                        onclick="showOpinion('expert${idx + 1}', this)">
                    Expert ${idx + 1} (${getModelName(exp.model)})
                </button>
            `).join('');

            document.getElementById('opinionTabs').innerHTML = tabsHTML;
            showOpinion('expert1', document.querySelector('.opinion-tab'));

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function showOpinion(expertKey, tabElement) {
            // Update tabs
            document.querySelectorAll('.opinion-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');

            // Show content
            document.getElementById('opinionContent').textContent = currentOpinions[expertKey] || 'Opinion non disponible';
        }

        // ============================================
        // Error Handling
        // ============================================
        function showError(message) {
            const toast = document.getElementById('errorToast');
            document.getElementById('errorMessage').textContent = message;
            toast.classList.add('visible');

            setTimeout(() => {
                toast.classList.remove('visible');
            }, 5000);
        }

        // Listen for review checkbox
        document.getElementById('enableReview').addEventListener('change', updateEstimate);
    </script>
<!-- ========== CHATBOT HELP FLOTTANT - √Ä inclure avant 
<div id="cb-help" style="position: fixed; bottom: 24px; right: 24px; z-index: 9999;">
    <button onclick="document.getElementById('cb-fr').style.display = document.getElementById('cb-fr').style.display === 'block' ? 'none' : 'block'" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #00a651, #00d66a); border: none; cursor: pointer; color: white; font-size: 24px;">?</button>
    <div id="cb-fr" style="display: none; position: fixed; bottom: 100px; right: 24px; width: 380px; height: 600px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); background: white; overflow: hidden;">
        <iframe src="../chatbot-ia/index.html" style="width: 100%; height: 100%; border: none;"></iframe>
    </div>
</div>
    <script src="/apps/shared/iafactory-unified.js"></script>
    <div data-iaf-footer></div>
\1 ========== -->
</div>

<script>
// ============================================
        
        if (!response.ok) throw new Error('Erreur API');
        
        const data = await response.json();
        const botResponse = data.choices?.[0]?.message?.content || 'D√©sol√©, je n\'ai pas pu r√©pondre.';
        
    } catch (error) {
        const messagesContainer = document.getElementById('helpMessages');
        if (messagesContainer && messagesContainer.lastChild) {
            messagesContainer.removeChild(messagesContainer.lastChild);
        }
    }
}

    const messagesContainer = document.getElementById('helpMessages');
    if (!messagesContainer) return;
    const messageDiv = document.createElement('div');
    messageDiv.className = `help-message help-${sender}`;
    
    const avatar = sender === 'bot'
        ? `<div style="width: 32px; height: 32px; background: linear-gradient(135deg, #00843D 0%, #2ecc71 100%); color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 11px;">DZ</div>`
        : 'üë§';

    messageDiv.innerHTML = `
        <div class="help-avatar">${avatar}</div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

}
</script>

<style>
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 9999;
    display: flex;
    align-items: center;
    gap: 12px;
}

.help-label {
    background: #00A651;
    color: white;
    padding: 10px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    white-space: nowrap;
    box-shadow: 0 4px 15px rgba(0, 166, 81, 0.3);
    opacity: 0;
    transform: translateX(20px);
    transition: all 0.3s ease;
    pointer-events: none;
}

    opacity: 1;
    transform: translateX(0);
}

.help-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #00A651;
    border: none;
    cursor: pointer;
    font-size: 28px;
    box-shadow: 0 4px 20px rgba(0, 166, 81, 0.4);
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.help-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(0, 166, 81, 0.6);
}

.help-window {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 340px;
    height: 480px;
    background: var(--bg-card, #0f172a);
    border: 1px solid var(--border-color, rgba(255,255,255,0.12));
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    display: none;
    flex-direction: column;
    overflow: hidden;
}

.help-window.open {
    display: flex;
}

.help-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: #00A651;
    color: white;
}

.help-header h3 {
    margin: 0;
    font-size: 18px;
}

.close-help-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
}

.help-messages {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.help-message {
    display: flex;
    gap: 8px;
    align-items: flex-start;
}

.help-message.help-user {
    flex-direction: row-reverse;
}

.help-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
}

    max-width: 75%;
    padding: 10px 14px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.4;
}

    background: var(--border-color, rgba(255,255,255,0.1));
    color: var(--text-primary, #f8fafc);
    border-bottom-left-radius: 4px;
}

    background: #00A651;
    color: white;
    border-bottom-right-radius: 4px;
}

.help-input {
    display: flex;
    padding: 12px;
    gap: 8px;
    border-top: 1px solid var(--border-color, rgba(255,255,255,0.12));
    background: var(--bg-card, #0f172a);
}

.help-input input {
    flex: 1;
    padding: 10px 14px;
    border: 1px solid var(--border-color, rgba(255,255,255,0.12));
    border-radius: 20px;
    background: var(--input-bg, #1e293b);
    color: var(--input-text, #f8fafc);
    font-size: 14px;
}

.help-input input:focus {
    outline: none;
    border-color: #00A651;
}

.help-send-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #00A651;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s;
}

.help-send-btn:hover {
    background: #008c44;
}

@media (max-width: 768px) {
        bottom: 20px;
        right: 15px;
    }
    .help-window {
        width: calc(100vw - 30px);
        height: 60vh;
        bottom: 80px;
        right: -5px;
    }
    .help-btn {
        width: 56px;
        height: 56px;
        font-size: 24px;
    }
}
</style>


<div id="cb-help" style="position: fixed; bottom: 24px; right: 24px; z-index: 9999;">
    <button onclick="document.getElementById('cb-fr').style.display = document.getElementById('cb-fr').style.display === 'block' ? 'none' : 'block'" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #00a651, #00d66a); border: none; cursor: pointer; color: white; font-size: 24px;">?</button>
    <div id="cb-fr" style="display: none; position: fixed; bottom: 100px; right: 24px; width: 380px; height: 600px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); background: white; overflow: hidden;">
        <iframe src="../chatbot-ia/index.html" style="width: 100%; height: 100%; border: none;"></iframe>
    </div>
</div>

        <div style="display:flex;padding:8px;gap:4px;background:rgba(0,0,0,0.2);">
            <button class="iaf-chatbot-mode active" id="iaf-mode-chat" onclick="IAFactory.setChatMode('chat')" style="flex:1;padding:8px;border:none;background:var(--accent,#00a651);color:white;cursor:pointer;border-radius:8px;font-size:12px;" data-i18n="chatbotModeChat">Chat IA</button>
            <button class="iaf-chatbot-mode" id="iaf-mode-rag" onclick="IAFactory.setChatMode('rag')" style="flex:1;padding:8px;border:none;background:transparent;color:inherit;cursor:pointer;border-radius:8px;font-size:12px;opacity:0.6;" data-i18n="chatbotModeRag">Recherche</button>
            <button class="iaf-chatbot-mode" id="iaf-mode-support" onclick="IAFactory.setChatMode('support')" style="flex:1;padding:8px;border:none;background:transparent;color:inherit;cursor:pointer;border-radius:8px;font-size:12px;opacity:0.6;" data-i18n="chatbotModeSupport">Support</button>
        </div>
        <div class="iaf-chatbot-messages" id="iaf-chatbot-messages" style="flex:1;overflow-y:auto;padding:16px;">
            <div style="display:flex;gap:8px;margin-bottom:12px;">
                <div style="width:32px;height:32px;background:linear-gradient(135deg,#00a651,#00d66a);color:white;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:11px;flex-shrink:0;">DZ</div>
                <div style="background:rgba(0,0,0,0.2);padding:10px 14px;border-radius:12px;max-width:80%;font-size:14px;line-height:1.4;" data-i18n="chatbotWelcome" data-i18n-html>üëã Bonjour ! Je suis <strong>Dzir IA</strong>. Comment puis-je vous aider ?</div>
            </div>
        </div>
        <div style="display:flex;padding:12px;gap:8px;border-top:1px solid rgba(255,255,255,0.1);">
            <input type="text" id="iaf-chatbot-input" placeholder="Tapez votre message..." data-i18n-placeholder="chatbotPlaceholder" onkeypress="if(event.key==='Enter')IAFactory.sendChatMessage()" style="flex:1;padding:10px 14px;border:1px solid rgba(255,255,255,0.1);border-radius:20px;background:rgba(0,0,0,0.2);color:inherit;outline:none;font-size:14px;">
            <button onclick="IAFactory.sendChatMessage()" style="width:40px;height:40px;border-radius:50%;border:none;background:#00a651;color:white;cursor:pointer;font-size:16px;">‚û§</button>
        </div>
    </div>

<button class="iaf-chatbot-btn" onclick="IAFactory.toggleChatbot()" title="Aide" aria-label="Aide">üí¨</button>
</body>
</html>
