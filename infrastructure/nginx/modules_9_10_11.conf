    # =======================================================
    # OBSERVABILITY STACK - Grafana, Prometheus (Module 9)
    # =======================================================

    # Grafana Dashboard
    location /grafana {
        rewrite ^/grafana$ /grafana/ permanent;
    }

    location /grafana/ {
        proxy_pass http://127.0.0.1:3033/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # Prometheus (protected)
    location /prometheus/ {
        auth_basic "Prometheus Admin";
        auth_basic_user_file /etc/nginx/.htpasswd_monitoring;
        proxy_pass http://127.0.0.1:9090/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Alertmanager (protected)
    location /alertmanager/ {
        auth_basic "Alertmanager Admin";
        auth_basic_user_file /etc/nginx/.htpasswd_monitoring;
        proxy_pass http://127.0.0.1:9093/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # =======================================================
    # PACK PME DZ - CoPilot IA PME (Module 10)
    # =======================================================

    # Pack PME DZ API
    location /api/pme/ {
        proxy_pass http://127.0.0.1:8210/api/pme/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 120s;
    }

    # Pack PME DZ UI
    location /pme {
        rewrite ^/pme$ /pme/ permanent;
    }

    location /pme/ {
        proxy_pass http://127.0.0.1:8211/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # =======================================================
    # CRM IA - Gestion Dossiers Clients (Module 11)
    # =======================================================

    # CRM API
    location /api/crm/ {
        proxy_pass http://127.0.0.1:8212/api/crm/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 120s;
        client_max_body_size 50M;
    }

    # CRM UI
    location /crm {
        rewrite ^/crm$ /crm/ permanent;
    }

    location /crm/ {
        proxy_pass http://127.0.0.1:8213/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
