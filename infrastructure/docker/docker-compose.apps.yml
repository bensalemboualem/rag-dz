version: '3.8'

services:
  # Hub principal - Interface RAG
  iafactory-hub:
    image: iafactory_iafactory-hub:latest
    container_name: iaf-hub-prod
    environment:
      VITE_API_URL: https://www.iafactoryalgeria.com/api
      VITE_WS_URL: wss://www.iafactoryalgeria.com
      VITE_ALLOWED_HOSTS: www.iafactoryalgeria.com,iafactoryalgeria.com,localhost,127.0.0.1
      NODE_ENV: production
    ports:
      - 127.0.0.1:8182:3737
    networks:
      - iaf-prod-network
    restart: unless-stopped

  # Documentation
  iafactory-docs:
    image: iafactory_iafactory-docs:latest
    container_name: iaf-docs-prod
    environment:
      VITE_API_URL: https://www.iafactoryalgeria.com/api
      VITE_ALLOWED_HOSTS: www.iafactoryalgeria.com,iafactoryalgeria.com,localhost,127.0.0.1
      NODE_ENV: production
    ports:
      - 127.0.0.1:8183:5173
    networks:
      - iaf-prod-network
    restart: unless-stopped

  # Studio Cr√©atif (Bolt)
  iafactory-studio:
    build:
      context: ./bolt-diy
      dockerfile: Dockerfile.dev
    container_name: iaf-studio-prod
    environment:
      VITE_API_URL: https://www.iafactoryalgeria.com/api
      VITE_ALLOWED_HOSTS: www.iafactoryalgeria.com,iafactoryalgeria.com,localhost,127.0.0.1
      GROQ_API_KEY: ${GROQ_API_KEY}
      NODE_ENV: development
    ports:
      - 127.0.0.1:8184:5173
    networks:
      - iaf-prod-network
    restart: unless-stopped

  # Council - Configuration d'experts IA
  iafactory-council:
    image: nginx:alpine
    container_name: iaf-council-prod
    volumes:
      - ./apps/council:/usr/share/nginx/html:ro
    ports:
      - 127.0.0.1:8185:80
    networks:
      - iaf-prod-network
    restart: unless-stopped

  # Ithy - Recherche IA
  iafactory-ithy:
    image: nginx:alpine
    container_name: iaf-ithy-prod
    volumes:
      - ./apps/ithy:/usr/share/nginx/html:ro
    ports:
      - 127.0.0.1:8186:80
    networks:
      - iaf-prod-network
    restart: unless-stopped

  # NotebookLM - Interface notebook
  iafactory-notebook:
    image: nginx:alpine
    container_name: iaf-notebook-prod
    volumes:
      - ./apps/notebook:/usr/share/nginx/html:ro
    ports:
      - 127.0.0.1:8187:80
    networks:
      - iaf-prod-network
    restart: unless-stopped

  # Business Plan - BMAD
  iafactory-bmad:
    image: node:18-alpine
    container_name: iaf-bmad-prod
    working_dir: /app
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
    volumes:
      - ./bmad:/app
    ports:
      - 127.0.0.1:8188:5173
    networks:
      - iaf-prod-network
    restart: unless-stopped

networks:
  iaf-prod-network:
    external: true
